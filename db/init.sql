CREATE DATABASE IF NOT EXISTS bwastartup;

USE bwastartup;

CREATE TABLE IF NOT EXISTS users(
    id CHAR(36) PRIMARY KEY NOT NULL,
    name VARCHAR(100) NOT NULL,
    occupation VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    avatar_file_name VARCHAR(255),
    role VARCHAR(255) NOT NULL,
    token VARCHAR(255),
    created_by CHAR(36) NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by CHAR(36) NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000',
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS campaigns(
    id CHAR(36) NOT NULL PRIMARY KEY,
    user_id CHAR(36) NOT NULL,
    title VARCHAR(255) NOT NULL,
    short_description VARCHAR(100) NOT NULL,
    description TEXT,
    goal_amount INT UNSIGNED,
    current_amount INT UNSIGNED,
    perks TEXT,
    becker_count INT,
    slug VARCHAR(255),
    created_by CHAR(36) NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by CHAR(36) NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000',
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS campaign_images(
    id CHAR(36) NOT NULL PRIMARY KEY,
    campaign_id CHAR(36) NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    is_primary TINYINT(1) UNSIGNED NOT NULL,
    created_by CHAR(36) NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by CHAR(36) NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000',
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS transactions(
    id CHAR(36) NOT NULL,
    user_id CHAR(36) NOT NULL,
    campaign_id CHAR(36) NOT NULL,
    amount INT UNSIGNED NOT NULL,
    status VARCHAR(50) NOT NULL,
    code VARCHAR(50) NOT NULL,
    created_by CHAR(36) NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by CHAR(36) NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000',
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS status_transaction(
    name VARCHAR(50) PRIMARY KEY
);

INSERT INTO status_transaction VALUES
('pending'),
('process'),
('completed');

ALTER TABLE campaigns ADD CONSTRAINT fk_campaign_user FOREIGN KEY (user_id) REFERENCES users(id);

ALTER TABLE campaign_images ADD CONSTRAINT fk_campaign_images_campaign FOREIGN KEY (campaign_id) REFERENCES campaigns(id);

ALTER TABLE transactions ADD CONSTRAINT fk_transactions_user FOREIGN KEY (user_id) REFERENCES users(id);

ALTER TABLE transactions ADD CONSTRAINT fk_transactions_campaign FOREIGN KEY (campaign_id) REFERENCES campaigns(id);

ALTER TABLE transactions ADD CONSTRAINT fk_transactions_status FOREIGN KEY (status) REFERENCES status_transaction(name);